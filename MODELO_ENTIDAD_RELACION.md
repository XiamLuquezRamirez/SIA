# üìä Modelo Entidad-Relaci√≥n - Sistema SIA

## üóÑÔ∏è Diagrama ER (Mermaid)

```mermaid
erDiagram
    USERS ||--o{ USERS : "coordinador de √°rea"
    USERS ||--o{ USERS : "l√≠der de equipo"
    USERS }o--|| AREAS : "pertenece a"
    USERS }o--|| EQUIPOS : "pertenece a"
    AREAS ||--o{ EQUIPOS : "contiene"
    AREAS ||--o| USERS : "coordinador"
    EQUIPOS ||--o| USERS : "l√≠der"
    USERS }o--o{ ROLES : "tiene"
    ROLES }o--o{ PERMISSIONS : "contiene"
    USERS }o--o{ PERMISSIONS : "tiene directos"

    USERS {
        bigint id PK
        string tipo_documento
        string cedula UK
        string nombre
        string apellidos
        string email UK
        string password
        string telefono
        string celular
        string direccion
        string foto_url
        bigint area_id FK
        bigint equipo_id FK
        string cargo
        enum tipo_usuario "interno/externo"
        boolean activo
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }

    AREAS {
        bigint id PK
        string nombre        
        text descripcion
        bigint coordinador_id FK
        boolean activo
        timestamp created_at
        timestamp updated_at
    }

    EQUIPOS {
        bigint id PK
        string nombre
        bigint area_id FK
        bigint lider_id FK
        text funciones
        boolean activo
        timestamp created_at
        timestamp updated_at
    }

    ROLES {
        bigint id PK
        string name UK
        string guard_name
        timestamp created_at
        timestamp updated_at
    }

    PERMISSIONS {
        bigint id PK
        string name UK
        string guard_name
        timestamp created_at
        timestamp updated_at
    }

    MODEL_HAS_ROLES {
        bigint role_id FK
        string model_type
        bigint model_id FK
    }

    MODEL_HAS_PERMISSIONS {
        bigint permission_id FK
        string model_type
        bigint model_id FK
    }

    ROLE_HAS_PERMISSIONS {
        bigint permission_id FK
        bigint role_id FK
    }

    PASSWORD_RESET_TOKENS {
        string email PK
        string token
        timestamp created_at
    }

    FAILED_JOBS {
        bigint id PK
        string uuid UK
        text connection
        text queue
        longtext payload
        longtext exception
        timestamp failed_at
    }

    PERSONAL_ACCESS_TOKENS {
        bigint id PK
        string tokenable_type
        bigint tokenable_id
        string name
        string token UK
        text abilities
        timestamp last_used_at
        timestamp expires_at
        timestamp created_at
        timestamp updated_at
    }
```

---

## üìã Descripci√≥n de Tablas

### 1. **USERS (Usuarios)** üë•
**Tabla central del sistema**

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| tipo_documento | VARCHAR | CC, CE, Pasaporte |
| cedula | VARCHAR | N√∫mero de documento (√∫nico) |
| nombre | VARCHAR | Nombres del usuario |
| apellidos | VARCHAR | Apellidos del usuario |
| email | VARCHAR | Correo electr√≥nico (√∫nico) |
| password | VARCHAR | Contrase√±a hasheada |
| telefono | VARCHAR | Tel√©fono fijo |
| celular | VARCHAR | Tel√©fono celular |
| direccion | VARCHAR | Direcci√≥n de residencia |
| foto_url | VARCHAR | URL de foto de perfil |
| area_id | BIGINT | FK a AREAS |
| equipo_id | BIGINT | FK a EQUIPOS |
| cargo | VARCHAR | Cargo del funcionario |
| tipo_usuario | ENUM | 'interno' o 'externo' |
| activo | BOOLEAN | Estado del usuario |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |
| deleted_at | TIMESTAMP | Soft delete |

**Relaciones:**
- `belongsTo(Area)` ‚Üí Un usuario pertenece a un √°rea
- `belongsTo(Equipo)` ‚Üí Un usuario pertenece a un equipo
- `hasMany(Area, 'coordinador_id')` ‚Üí Un usuario puede ser coordinador de √°reas
- `hasMany(Equipo, 'lider_id')` ‚Üí Un usuario puede ser l√≠der de equipos
- `belongsToMany(Role)` ‚Üí Un usuario tiene m√∫ltiples roles
- `belongsToMany(Permission)` ‚Üí Un usuario puede tener permisos directos

---

### 2. **AREAS (√Åreas Organizacionales)** üè¢

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| nombre | VARCHAR | Nombre del √°rea |
| slug | VARCHAR | Slug √∫nico para URLs |
| descripcion | TEXT | Descripci√≥n del √°rea |
| coordinador_id | BIGINT | FK a USERS (coordinador) |
| activo | BOOLEAN | Estado del √°rea |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |

**Relaciones:**
- `belongsTo(User, 'coordinador_id')` ‚Üí Un √°rea tiene un coordinador
- `hasMany(Equipo)` ‚Üí Un √°rea tiene m√∫ltiples equipos
- `hasMany(User)` ‚Üí Un √°rea tiene m√∫ltiples usuarios

**Reglas:**
- Un √°rea puede tener un solo coordinador
- Un √°rea puede tener m√∫ltiples equipos
- Un coordinador debe ser un usuario interno

---

### 3. **EQUIPOS (Equipos de Trabajo)** üë•

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| nombre | VARCHAR | Nombre del equipo |
| slug | VARCHAR | Slug √∫nico para URLs |
| area_id | BIGINT | FK a AREAS |
| lider_id | BIGINT | FK a USERS (l√≠der) |
| funciones | TEXT | Descripci√≥n de funciones |
| activo | BOOLEAN | Estado del equipo |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |

**Relaciones:**
- `belongsTo(Area)` ‚Üí Un equipo pertenece a un √°rea
- `belongsTo(User, 'lider_id')` ‚Üí Un equipo tiene un l√≠der
- `hasMany(User)` ‚Üí Un equipo tiene m√∫ltiples miembros

**Reglas:**
- Un equipo pertenece a una sola √°rea
- Un equipo puede tener un solo l√≠der
- Un l√≠der debe ser un usuario interno del √°rea

---

### 4. **ROLES (Roles del Sistema)** üé≠

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| name | VARCHAR | Nombre del rol (√∫nico) |
| guard_name | VARCHAR | Guard de autenticaci√≥n |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |

**Relaciones:**
- `belongsToMany(Permission)` ‚Üí Un rol tiene m√∫ltiples permisos
- `belongsToMany(User)` ‚Üí Un rol puede ser asignado a m√∫ltiples usuarios

**Ejemplos de Roles:**
- Super Administrador
- Director OAPM
- Coordinador
- L√≠der de Equipo
- Funcionario
- Ciudadano

---

### 5. **PERMISSIONS (Permisos)** üîê

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| name | VARCHAR | Nombre del permiso (√∫nico) |
| guard_name | VARCHAR | Guard de autenticaci√≥n |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |

**Relaciones:**
- `belongsToMany(Role)` ‚Üí Un permiso puede estar en m√∫ltiples roles
- `belongsToMany(User)` ‚Üí Un permiso puede ser asignado directamente a usuarios

**Estructura de Nombres:**
- `modulo.accion`
- Ejemplos: `usuarios.ver`, `usuarios.crear`, `usuarios.editar`, `usuarios.eliminar`

---

### 6. **MODEL_HAS_ROLES (Pivot)** üîó

**Tabla de relaci√≥n muchos a muchos entre Usuarios y Roles**

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| role_id | BIGINT | FK a ROLES |
| model_type | VARCHAR | Tipo de modelo (App\Models\User) |
| model_id | BIGINT | FK al modelo (user.id) |

**Uso:** Polim√≥rfica - puede asignar roles a diferentes tipos de modelos

---

### 7. **ROLE_HAS_PERMISSIONS (Pivot)** üîó

**Tabla de relaci√≥n muchos a muchos entre Roles y Permisos**

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| permission_id | BIGINT | FK a PERMISSIONS |
| role_id | BIGINT | FK a ROLES |

**Uso:** Define qu√© permisos tiene cada rol

---

### 8. **MODEL_HAS_PERMISSIONS (Pivot)** üîó

**Permisos directos asignados a usuarios**

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| permission_id | BIGINT | FK a PERMISSIONS |
| model_type | VARCHAR | Tipo de modelo |
| model_id | BIGINT | FK al modelo |

**Uso:** Permite asignar permisos espec√≠ficos a usuarios sin crear un rol

---

### 9. **PASSWORD_RESET_TOKENS** üîë

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| email | VARCHAR | Email del usuario (PK) |
| token | VARCHAR | Token de reseteo |
| created_at | TIMESTAMP | Fecha de creaci√≥n |

**Uso:** Gesti√≥n de recuperaci√≥n de contrase√±as

---

### 10. **FAILED_JOBS** ‚ùå

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| uuid | VARCHAR | UUID del job |
| connection | TEXT | Conexi√≥n de cola |
| queue | TEXT | Nombre de cola |
| payload | LONGTEXT | Datos del job |
| exception | LONGTEXT | Excepci√≥n generada |
| failed_at | TIMESTAMP | Fecha de fallo |

**Uso:** Registro de jobs fallidos en cola

---

### 11. **PERSONAL_ACCESS_TOKENS** üé´

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| id | BIGINT | Identificador √∫nico |
| tokenable_type | VARCHAR | Tipo de modelo |
| tokenable_id | BIGINT | FK al modelo |
| name | VARCHAR | Nombre del token |
| token | VARCHAR | Token √∫nico (hash) |
| abilities | TEXT | Permisos del token (JSON) |
| last_used_at | TIMESTAMP | √öltimo uso |
| expires_at | TIMESTAMP | Fecha de expiraci√≥n |
| created_at | TIMESTAMP | Fecha de creaci√≥n |
| updated_at | TIMESTAMP | Fecha de actualizaci√≥n |

**Uso:** Autenticaci√≥n API con Sanctum

---

## üîó Relaciones Principales

### Jerarqu√≠a Organizacional:

```
AREA (Departamento/Divisi√≥n)
  ‚îú‚îÄ‚îÄ coordinador: USER
  ‚îú‚îÄ‚îÄ EQUIPOS (m√∫ltiples)
  ‚îÇ     ‚îú‚îÄ‚îÄ lider: USER
  ‚îÇ     ‚îî‚îÄ‚îÄ miembros: USERS (m√∫ltiples)
  ‚îî‚îÄ‚îÄ usuarios: USERS (m√∫ltiples)
```

### Sistema de Permisos (Spatie):

```
USER
  ‚îú‚îÄ‚îÄ roles: ROLES (m√∫ltiples) [via MODEL_HAS_ROLES]
  ‚îÇ     ‚îî‚îÄ‚îÄ permissions: PERMISSIONS (m√∫ltiples) [via ROLE_HAS_PERMISSIONS]
  ‚îî‚îÄ‚îÄ permissions directos: PERMISSIONS (m√∫ltiples) [via MODEL_HAS_PERMISSIONS]
```

---

## üìù Cardinalidades

| Relaci√≥n | Tipo | Descripci√≥n |
|----------|------|-------------|
| User ‚Üí Area | N:1 | Muchos usuarios en un √°rea |
| User ‚Üí Equipo | N:1 | Muchos usuarios en un equipo |
| Area ‚Üí User (coordinador) | 1:1 | Un √°rea tiene un coordinador |
| Equipo ‚Üí User (l√≠der) | 1:1 | Un equipo tiene un l√≠der |
| Area ‚Üí Equipos | 1:N | Un √°rea tiene muchos equipos |
| Equipo ‚Üí Area | N:1 | Muchos equipos en un √°rea |
| User ‚Üí Roles | N:M | Usuarios tienen m√∫ltiples roles |
| Role ‚Üí Permissions | N:M | Roles tienen m√∫ltiples permisos |
| User ‚Üí Permissions | N:M | Usuarios pueden tener permisos directos |

---

## üéØ Reglas de Negocio

### Usuarios:
1. ‚úÖ Un usuario puede ser **funcionario** (interno) o **ciudadano** (externo)
2. ‚úÖ Solo funcionarios tienen √°rea, equipo y cargo
3. ‚úÖ Un usuario puede ser coordinador de UN √°rea
4. ‚úÖ Un usuario puede ser l√≠der de UN equipo
5. ‚úÖ Un usuario debe tener al menos UN rol
6. ‚úÖ Email y c√©dula son √∫nicos
7. ‚úÖ Usa soft deletes (no se eliminan f√≠sicamente)

### √Åreas:
1. ‚úÖ Deben tener un nombre y slug √∫nicos
2. ‚úÖ Pueden tener un coordinador (opcional)
3. ‚úÖ Contienen m√∫ltiples equipos
4. ‚úÖ Contienen m√∫ltiples usuarios

### Equipos:
1. ‚úÖ Pertenecen a UN √°rea
2. ‚úÖ Pueden tener un l√≠der (opcional)
3. ‚úÖ El l√≠der debe ser del √°rea correspondiente
4. ‚úÖ Tienen m√∫ltiples miembros

### Roles y Permisos:
1. ‚úÖ Los roles agrupan permisos
2. ‚úÖ Un usuario puede tener m√∫ltiples roles
3. ‚úÖ Los permisos se heredan de los roles
4. ‚úÖ Se pueden asignar permisos directos a usuarios (sin rol)
5. ‚úÖ Formato de permisos: `modulo.accion` (ej: `usuarios.ver`)

---

## üìê Diagrama Visual Simplificado

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         AREA                                ‚îÇ
‚îÇ  + id                                                       ‚îÇ
‚îÇ  + nombre                                                   ‚îÇ
‚îÇ  + coordinador_id ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò
               ‚îÇ            ‚îÇ                              ‚îÇ
               ‚îÇ            ‚îÇ                              ‚îÇ
        contiene equipos    ‚îÇ                     contiene usuarios
               ‚îÇ            ‚îÇ                              ‚îÇ
               ‚ñº            ‚îÇ                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       EQUIPO         ‚îÇ   ‚îÇ                   ‚îÇ        USER         ‚îÇ
‚îÇ  + id                ‚îÇ   ‚îÇ                   ‚îÇ  + id               ‚îÇ
‚îÇ  + nombre            ‚îÇ   ‚îÇ                   ‚îÇ  + cedula           ‚îÇ
‚îÇ  + area_id ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ                   ‚îÇ  + nombre           ‚îÇ
‚îÇ  + lider_id ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ  + email            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îÇ  + tipo_usuario     ‚îÇ
       ‚îÇ                                       ‚îÇ  + area_id          ‚îÇ
       ‚îÇ                                       ‚îÇ  + equipo_id        ‚îÇ
       ‚îÇ                                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                              ‚îÇ
    tiene miembros                              tiene roles
       ‚îÇ                                              ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ       ROLE       ‚îÇ
                    ‚îÇ  + id            ‚îÇ
                    ‚îÇ  + name          ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                      tiene permisos
                             ‚îÇ
                             ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   PERMISSION     ‚îÇ
                    ‚îÇ  + id            ‚îÇ
                    ‚îÇ  + name          ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîë √çndices y Constraints

### Unique Constraints:
- `users.email` ‚Üí √önico
- `users.cedula` ‚Üí √önico
- `areas.slug` ‚Üí √önico
- `equipos.slug` ‚Üí √önico
- `roles.name + guard_name` ‚Üí √önico compuesto
- `permissions.name + guard_name` ‚Üí √önico compuesto

### Foreign Keys:
- `users.area_id` ‚Üí `areas.id`
- `users.equipo_id` ‚Üí `equipos.id`
- `areas.coordinador_id` ‚Üí `users.id`
- `equipos.area_id` ‚Üí `areas.id`
- `equipos.lider_id` ‚Üí `users.id`

### Cascade Actions:
- Al eliminar un rol ‚Üí Elimina relaciones en `model_has_roles`
- Al eliminar un permiso ‚Üí Elimina relaciones en `role_has_permissions`
- Al eliminar usuario ‚Üí Soft delete (no elimina f√≠sicamente)

---

## üìä Estad√≠sticas Actuales del Esquema

| M√©trica | Valor |
|---------|-------|
| Tablas principales | 3 (Users, Areas, Equipos) |
| Tablas de autenticaci√≥n | 4 (Roles, Permissions, tokens, etc.) |
| Tablas pivot | 3 (model_has_roles, etc.) |
| Total de tablas | 11 |
| Relaciones many-to-many | 3 |
| Relaciones one-to-many | 4 |
| Relaciones one-to-one | 2 |

---

## üöÄ Extensiones Futuras Sugeridas

### Tablas a Agregar:

1. **TAREAS** üìã
   - Para gesti√≥n de tareas
   - FK a usuario_asignado_id
   - FK a area_id, equipo_id

2. **SOLICITUDES** üì®
   - Para solicitudes de ciudadanos
   - FK a usuario_id (solicitante)
   - FK a usuario_asignado_id

3. **DOCUMENTOS** üìÑ
   - Para gesti√≥n documental
   - FK a usuario_id (creador)
   - FK a area_id

4. **ACTIVITY_LOG** üìä
   - Para auditor√≠a completa
   - FK a user_id
   - Registro de todas las acciones

5. **NOTIFICACIONES** üîî
   - Para sistema de notificaciones
   - FK a user_id
   - Polim√≥rfica a diferentes entidades

---

## üìñ Consultas SQL Comunes

### Obtener usuarios con su √°rea y equipo:
```sql
SELECT u.*, a.nombre as area_nombre, e.nombre as equipo_nombre
FROM users u
LEFT JOIN areas a ON u.area_id = a.id
LEFT JOIN equipos e ON u.equipo_id = e.id
WHERE u.activo = true;
```

### Obtener coordinadores de √°reas:
```sql
SELECT a.nombre as area, u.nombre, u.apellidos
FROM areas a
INNER JOIN users u ON a.coordinador_id = u.id
WHERE a.activo = true;
```

### Obtener l√≠deres de equipos:
```sql
SELECT e.nombre as equipo, u.nombre, u.apellidos, a.nombre as area
FROM equipos e
INNER JOIN users u ON e.lider_id = u.id
INNER JOIN areas a ON e.area_id = a.id
WHERE e.activo = true;
```

### Obtener permisos efectivos de un usuario:
```sql
SELECT DISTINCT p.name
FROM permissions p
INNER JOIN role_has_permissions rhp ON p.id = rhp.permission_id
INNER JOIN model_has_roles mhr ON rhp.role_id = mhr.role_id
WHERE mhr.model_type = 'App\\Models\\User'
  AND mhr.model_id = ?
UNION
SELECT p.name
FROM permissions p
INNER JOIN model_has_permissions mhp ON p.id = mhp.permission_id
WHERE mhp.model_type = 'App\\Models\\User'
  AND mhp.model_id = ?;
```

---

## üé® Diagrama en Texto ASCII

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       USERS          ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ
‚îÇ ‚Ä¢ id (PK)            ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ cedula (UK)        ‚îÇ     ‚îÇ
‚îÇ ‚Ä¢ nombre             ‚îÇ     ‚îÇ
‚îÇ ‚Ä¢ email (UK)         ‚îÇ     ‚îÇ coordinador_id
‚îÇ ‚Ä¢ area_id (FK)       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ equipo_id (FK)     ‚îÇ‚îÄ‚îê   ‚îÇ         ‚îÇ
‚îÇ ‚Ä¢ tipo_usuario       ‚îÇ ‚îÇ   ‚îÇ         ‚îÇ
‚îÇ ‚Ä¢ activo             ‚îÇ ‚îÇ   ‚îÇ         ‚ñº
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ              ‚îÇ   ‚îÇ   ‚îÇ    AREAS     ‚îÇ
          ‚îÇ              ‚îÇ   ‚îÇ   ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
      tiene roles        ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ id (PK)    ‚îÇ
          ‚îÇ              ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÇ ‚Ä¢ coord_id   ‚îÇ
          ‚ñº              ‚îÇ       ‚îÇ ‚Ä¢ nombre     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ       ‚îÇ ‚Ä¢ activo     ‚îÇ
‚îÇ      ROLES       ‚îÇ    ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ    ‚îÇ               ‚îÇ
‚îÇ ‚Ä¢ id (PK)        ‚îÇ    ‚îÇ           contiene
‚îÇ ‚Ä¢ name (UK)      ‚îÇ    ‚îÇ               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ               ‚ñº
         ‚îÇ              ‚îÇ       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    tiene permisos      ‚îÇ       ‚îÇ   EQUIPOS    ‚îÇ
         ‚îÇ              ‚îÇ       ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
         ‚ñº              ‚îÇ       ‚îÇ ‚Ä¢ id (PK)    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ       ‚îÇ ‚Ä¢ area_id    ‚îÇ
‚îÇ   PERMISSIONS    ‚îÇ   ‚îÇ       ‚îÇ ‚Ä¢ lider_id   ‚îÇ‚óÑ‚îÄ‚îê
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ   ‚îÇ       ‚îÇ ‚Ä¢ nombre     ‚îÇ  ‚îÇ
‚îÇ ‚Ä¢ id (PK)        ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ ‚Ä¢ name (UK)      ‚îÇ   ‚îÇ                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           pertenece a equipo
```

---

## üìÑ Archivo Generado

**Fecha:** Octubre 2024  
**Basado en:** Modelos Laravel y Migraciones  
**Herramientas:** Spatie Permission Package  
**Estado:** ‚úÖ Documentado

---

**Notas:**
- Usa Spatie Permission para roles y permisos
- Implementa soft deletes en usuarios
- Soporta relaciones polim√≥rficas
- Preparado para escalabilidad


